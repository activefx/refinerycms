<%= form_for [:admin, @user] do |f| -%>
  <%= render :partial => "/shared/admin/error_messages", :locals => {
          :object => @user,
          :include_object_name => true
        } %>

  <% if current_administrator.has_role?(:superuser) and RefinerySetting.find_or_set(:superuser_can_assign_roles, false) %>
    <div class='field role_access'>
      <span class='label_with_help'>
        <%= f.label :role_access, t('.role_access'), :class => "title_label" %>
      </span>
      <ul id='roles' class='checkboxes'>
        <% @available_roles.each do |role|
          downcased_title = (title = role[:title]).downcase -%>
          <li>
            <%= check_box_tag 'user[roles][]', downcased_title, @user.has_role?(title),
                              :id => "roles_#{downcased_title}" %>
            <%= f.label 'user[roles][]',
                        t(downcased_title, :scope => 'roles', :default => title),
                        :class => 'stripped',
                        :for => "roles_#{downcased_title}" %>
          </li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class='field'>
    <%= f.label :username %>
    <%= f.text_field :username %>
  </div>
  <div class='field'>
    <%= f.label :email %>
    <%= f.text_field :email %>
  </div>
  <div class='field'>
    <%= f.label :password %>
    <%= f.password_field :password, :autocomplete => 'off' %>
    <%= "<br /><span class='preview'>#{t('.blank_password_keeps_current')}</span>".html_safe if @user.persisted? %>
  </div>
  <div class='field'>
    <%= f.label :password_confirmation %>
    <%= f.password_field :password_confirmation, :autocomplete => 'off' %>
  </div>

  <%= render :partial => "/shared/admin/form_actions",
              :locals => {
                :f => f,
                :continue_editing => false,
                :hide_delete => true,
                :delete_title => t('delete', :scope => 'admin.users.user'),
                :delete_confirmation => t('message', :scope => 'shared.admin.delete', :title => @user.username)
              } %>
<% end -%>

<% content_for :javascripts do %>
  <script>
    $(document).ready(function() {
      $('#user_plugins_enable_all').click(function(e, a) {
        $('div.field.plugin_access ul#plugins li input:checkbox').attr('checked', true);
        e.preventDefault();
      });
    });
  </script>
<% end %>

